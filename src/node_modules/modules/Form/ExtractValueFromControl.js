import { isObject, isFunction, has } from 'underscore';
import { CustomFormValue } from './FormControlValue';

const parse = (target) => {
  let control = target;

  if (!isObject(control)) {
    return control;
  }

  if (isFunction(control)) {
    return control();
  }

  if (control instanceof Event) {
    control = control.target;
  }

  if (has(control, 'target')) {
    control = control.target;
  }

  if (control instanceof Element) {
    switch (control.type) {
      case 'select-one':
        return control.value;
      case 'checkbox':
        return control.checked;
      case 'number':
        return parseInt(control.value, 10);
      default:
        return control.value;
    }
  }

  if (control instanceof CustomFormValue) {
    return control.value;
  }

  return control;
};

export default parse;
