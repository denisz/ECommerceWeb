import { Store } from 'modules/Flux';
import Actions from './CollectionActions';
import XHR, { Methods } from './XHR';

export class Collection extends Store {
  constructor() {
    super();

    this.id = 'collection';
    this.listenables = Actions;
  }

  /**
   * Загрузка из сервера
   * @param sku
   * @returns {Promise.<void>}
   */
  async onFetch(sku) {
    const { responseData } = await XHR(Methods.POST, { path: `catalog/collection/${sku}` });
    this.setState(responseData);
  }

  /**
   * Загружаем если требуется
   * @param sku
   * @returns {Promise.<void>}
   */
  async onFetchIfNeeded(sku) {
    const currentSKU = this.get('sku');

    if (currentSKU !== sku) {
      await this.onFetch(sku);
    }
  }
}

export default new Collection();
